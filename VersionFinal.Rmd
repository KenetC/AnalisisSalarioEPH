---
title: "Analisis EPH"
output: html_notebook
---

####  Librerias necesarias

```{r}
library(quantreg);
library(eph);
library(dplyr);
library(tidyr);
library(ggplot2); 
source("utils.R");
library(dineq);
library(ineq);
library(knitr);
library(oaxaca);
```
Toda funcion auxiliar que uso a lo largo del trabajo esta en `utils.R`. Para detalles de implementacion y desiciones ir al archivo.

### **Introduccion**

En este análisis se pone el foco en explorar cómo el nivel educativo influye en los ingresos laborales en el mercado argentino. El objetivo principal es cuantificar, de manera precisa, el impacto de la educación, considerando además otras variables relevantes como la edad, la experiencia potencial y el tiempo dedicado al trabajo.

La base teórica de este análisis parte de una premisa ampliamente respaldada en la literatura, un mayor nivel educativo no solo incrementa las oportunidades laborales, sino que también mejora la calidad del empleo y los ingresos percibidos. Esto se explica a partir de procesos como la adquisición de habilidades especializadas, la generación de redes de contacto y el acceso a información académica avanzada, los cuales permiten a los individuos insertarse en sectores laborales mejor remunerados. De esta forma, la educación es considerada uno de los pilares fundamentales para la movilidad social y económica.

En el contexto del mercado laboral argentino, es particularmente relevante analizar estas relaciones, dado que las diferencias educativas suelen estar asociadas a desigualdades salariales significativas. Al mismo tiempo, existen disparidades regionales y urbanas que influyen en la calidad del empleo y en los niveles de ingreso de la población ocupada. Este análisis busca no solo aportar evidencia empírica sobre el impacto de la educación en los salarios, sino también destacar las posibles desigualdades presentes entre distintos grupos demográficos y geográficos.

Con este estudio, se espera aportar claridad sobre cómo el nivel educativo afecta los ingresos laborales en términos cuantitativos y cómo este impacto puede variar entre los diferentes sectores de la población argentina. Esto permitirá enriquecer el debate sobre políticas públicas orientadas a reducir las brechas salariales a través de la educación y la formación profesional.


####  **Lectura de datos**

```{r}
resultados <- datos(2023,4)

bases23 <- resultados$bases
bases23_rest <- resultados$bases_rest
hogares23 <- resultados$hogares

resultados <- datos(2024,2)

bases24 <- resultados$bases
bases24_rest <- resultados$bases_rest
hogares24 <- resultados$hogares

rm(resultados) # eliminamos la variable resultados
```
+ bases**N**: lista que contiene las bases de microdatos `individuales` correspondientes al anio 20**N** (los 4 trimestres).
+ bases**N**_rest: lista analoga a la anterior, pero habieno hecho una limpieza de los datos. 
+ hogares**N**: lista que contiene las bases de microdatos de `hogares` correspondientes al anio 20**N**.

Notar que al dia de la fecha, aun no estan disponibles los datos del 3er y 4to trimestre del 2024. Por ello no se tuvo en cuenta, pero haciendo un ligero cambio en `utils.R` se pueden agregar al analisis. 

#### **Preprocesamiento de datos y decisiones tomadas**

+ **Nombres representativos:**  
   Renombramos las variables para hacerlas más claras y representativas en el contexto del análisis.

+ **Eliminación de datos inconsistentes:**  
   Filtramos observaciones con valores lógicamente imposibles o inconsistentes. Por ejemplo:
   - Individuos que reportaron trabajar más de 168 horas semanales (el máximo teórico en una semana).
   - Otras inconsistencias identificadas en las variables clave del análisis.

+ **Manejo de datos faltantes:**  
   En este estudio, decidí no realizar imputaciones para los valores faltantes y, en cambio, eliminé las filas afectadas. Esta decisión se basó en las siguientes consideraciones:
   - **Evitar suposiciones fuertes:**  
      La imputación requiere hacer suposiciones sobre cómo se distribuyen los datos faltantes o su relación con otras variables. En este caso, los valores faltantes podrían estar asociados a fenómenos específicos, como licencias remuneradas, contratos especiales o errores de reporte, y no podemos garantizar que las imputaciones reflejarían con precisión estas situaciones.
   - **Minimizar el sesgo potencial:**  
      La imputación podría alterar las relaciones entre las variables explicativas y la variable dependiente, afectando la validez de los coeficientes estimados. Al eliminar estas observaciones, los resultados reflejan únicamente los datos observados.
   - **Transparencia y replicabilidad:**  
      Prioricé un enfoque transparente eliminando las filas con valores faltantes, manteniendo una muestra final suficientemente grande (\( n = 18,011 \)) para garantizar la representatividad del análisis.
   - **Consistencia con la literatura:**  
      En estudios econométricos similares, es común eliminar observaciones con valores faltantes cuando no se pueden realizar imputaciones con un nivel razonable de certeza. Esta práctica está alineada con estándares aceptados en el campo.

+ **Cálculo de años de educación (\( \text{anios_edu} \)):**  
   Estimamos los años de educación en función de las variables relacionadas con el nivel educativo, el año aprobado y si el nivel fue completado (ver `utis.R`, líneas 14-28).

+ **Estimación de experiencia potencial (\( \text{exp_pot} \)):**  
   Calculamos la experiencia potencial siguiendo la fórmula:  

   $$ \text{exp_pot} = \text{edad} - \text{anios_edu} - 6 $$

+ **Filtrado de filas por edad:**  
   Seleccionamos únicamente observaciones correspondientes a personas entre 25 y 65 años.  
   - Este rango de edad refleja mejor la población laboral estable y con trayectorias educativas y laborales completas. Incluir a menores de 25 años podría introducir ruido en los datos debido a educación incompleta o trabajos transitorios, mientras que mayores de 65 años suelen estar en transición hacia la jubilación.

+ **Horas mensuales:**
   - En los datos se encuentran las horas semanales trabajadas, lo que buscamos es calcular `log(horas mensuales)`, se opto por: 
   \[
\text{log_horas} = 
\begin{cases} 
0, & \text{si } \text{horas_semanales} = 0 \\ 
\log\left(\frac{365}{12 \cdot 7} \cdot \text{horas_semanales}\right), & \text{si no}
\end{cases}
\]

### Modelado 

Observando los siguientes histogramas vemos que lwage (logaritmo de salario) parece seguir una distribucion normal a diferencia de wage, por ello se considera esta transformacion. 

```{r}
comparacion(bases24_rest)
```
En el histograma vemos que el log(ingreso) de ahora en mas `l_i`, para ambos casos parecen seguir una distribucion normal, aun que no tienen la misma varianza, no se haran test de normalidad debido a la cantidad de estudios que hay de este dato, de hecho seguiremos la funcion de ganancia de Mincer que involucra esta transformacion del ingreso. Por otro lado, el boxplot vemos que `l_i` de los hombres en promerio es mayor que el sexo opuesto, tambien observamos que la varianza parece ser mayor en las mujeres.

Siguiendo la funcion de ganacia de `Mincer`, modelamos el efecto de la educacion sobre la media del logaritmo de los ingresos de la ocupacion principal, controlando con la ubicacion (variable categoria), edad,  experiencia potencial, estado civil, logaritmo de horas mensuales trabajadas y experiencia potencial y edad al cuadrado, fueron incorporadas para investigar los efectos no lineales de sus variaciones.
Una desventaja del mismo es que no podes asegurar que haya una linealidad de *anios_edu*, para ellos consideremos un segundo modelo donde representemos la educacion con una variable dummie que determina el maximo nivel educativo alcanzado.

##### **Modelo 1**

$$\text{log(ingreso)} = \text{anios_edu} + \text{edad} + \text{edad}^2 + \text{exp_pot} + \text{exp_pot}^2 +  \text{ubicacion (dummie)} + \text{log_horas}$$

##### **Modelo 2**

$$\text{log(ingreso)} = \text{nivel_ed (dummie)} + \text{edad} + \text{edad}^2 + \text{exp_pot} + \text{exp_pot}^2 + \text{ubicacion (dummie)} + \text{log_horas}$$
### **Regresiones**

### **FEM**

Comenzamos con el genero femenino

```{r}
base24_1_fem  <- f_restricciones(bases24[[1]], gender = "fem", asalariado = TRUE)

reg1_f <- lm(log(ingreso)~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = base24_1_fem)
reg2_f <- lm(log(ingreso)~ as.factor(NIVEL_ED) + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data=base24_1_fem)

summ_reg1_f <- summary(reg1_f)
summ_reg2_f <- summary(reg2_f)

# Extraer los coeficientes, errores estándar, valores t y p-valores del resumen del modelo
coef_reg1_f <- coef(summ_reg1_f)
coef_reg2_f <- coef(summ_reg2_f)

# Filtrar las filas de los coeficientes que nos interesan
coef_interes_reg1_f <- coef_reg1_f[c("anios_edu", "exp_pot"), ]
coef_interes_reg2_f <- coef_reg2_f[grep("NIVEL_ED", rownames(coef_reg2_f)), ] 
```

### **Efecto no lineal de la educacion en el retorno económico**

Graficamos la estimacion y su p-valor correspondiente del maximo nivel educativo alcanzado.

```{r}
graph_nivel_ed(coef_interes_reg2_f[,1], coef_interes_reg2_f[,4])
```

La variación de los coeficientes de la variable dummie **NIVEL_ED**, sugiere que el efecto en **log(ingreso)** de cada nivel educativo no es constante. Es decir, parece haber un efecto no lineal de la educación.

El retorno económico de completar un nivel educativo cambia significativamente dependiendo de qué nivel se está comparando. Por ejemplo, pasar de primario completo a secundario completo tiene un retorno significatiamente mayor, sugiriendo que las personas que completan el secundario pueden obtener un salario más alto que aquellos que sólo completan el primario. Pasar del secundario completo a estudios universitarios completos tambien aumenta el ingreso. Por otro lado tener estudios secundarios, universitarios incompletos tiene el efecto contrario al esperado, rompe con la tendencia creciente que veniamos observando. 

Los coeficientes para secundario completo y universitario incompleto y completo, son todos significativos pues su p-valor es menor a 0.01, ademas son positivos, lo que respalda la idea de que esos niveles educativos tienen un impacto positivo y relevante en los salarios.
Por otro lado, los coeficientes de **Sin instruccion**, **Primario completo** y **Primario incompleto** son similares, no son significativos, ya que su p-valor son mayores a 0.01, en tanto no son "influyentes" para estimar **log(ingreso)**.

La variación en los coeficientes y su significancia sugiere que el impacto de la educación en los salarios no es lineal. Esto es consistente con la idea de que ciertos niveles de educación (como completar la secundaria o la educación superior) ofrecen ventajas salariales más significativas que simplemente tener un año más de educación.

### ANOVA 

```{r}
anova(reg1_f,reg2_f)
```

Bajo las hipotesis de la prueba *ANOVA* de ambos modelos, vemos un p-valor menor a 0.01, en tanto controlando por las variables control (valga la redundancia) el nivel educativo máximo alcanzado como variable dummie de cada individuo resulta significativo, contra la variable continua. Esto refuerza la idea de que hay un efecto no lineal de la educación en los ingresos.

### **Heterogeneidad en el retorno de la educación | Regresion cuantilica**

El uso de regresiones por cuantiles permite capturar cómo el efecto marginal de los años de educación (**anios_edu**) sobre el logaritmo del ingreso varía a lo largo de la distribución de ingresos. Esto es especialmente relevante para entender cómo la educación afecta de manera diferenciada a mujeres asalariadas en distintos niveles de ingreso, desde las que se encuentran en sectores más vulnerables (cuantiles bajos) hasta las que ocupan posiciones más privilegiadas en términos de ingresos (cuantiles altos).

Un cambio respecto al modelo previamente evaluado es que al tener la variable **edad**, hace que la matriz de diseño no pueda invertirse para luego hacer la regresión por cuantiles, por lo tanto opte por quitar esta variable, respecto al analisis previo no hubo grandes cambios en los resultados, en tanto decidi no realizar el mismo cambio.

```{r}
taus = seq(0.01, 0.99, length.out = 20)
regq1_fem <- rq(log(ingreso)~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas,data=base24_1_fem,tau = taus,ci = FALSE)
summregq1_fem <- summary(regq1_fem,se="ker")

plot(summregq1_fem, parm =2,
     main = "Coeficientes: Años de Educación", xlab = "Tau (Cuantiles)", ylab = "Coeficientes (Años de Educación)") 
```

Los sectores con ingresos bajos el coeficiente va en ascenso, cercanos a 0.1 (τ de 0.1 a 0.3) **anios_ed** es alto comparado con los demas τ's, lo que indicaria que el efecto marginal de la educacion es mayor para las mujeres con estos ingresos. En otras palabras, para este grupo, cada año adicional de educación tiene un impacto mayor en el aumento de los mismos. Esto tiene sentido dado que al tener ingresos bajos, podrían beneficiarse más de la educación en términos de movilidad económica.

Cada año adicional de educación está asociado con un aumento promedio del salario del 11% (aprox)

El comportamiento de los siguientes cuantiles va en descenso, esto sugiere que para aquellos sectores que comienzan a percibir ingresos "medianos" el impacto de la educacion comienza a ser menos pronunciado a medida que τ aumenta, pues el efecto marginal de la educacion se atenua en este grupo, lo cual podria indicar que factores ademas de la educacion comienzan a juegar un rol mas importante en la determinacion de los ingresos, quizas otros factores como la experiencia laboral, habilidades específicas o redes sociales comienzan a tener mayor peso.

Cada año adicional de educación está asociado con un aumento promedio del salario del 8% (aprox)

Para cuantiles altos (τ por encima de 0.8) se estabiliza el coeficiente en los valores mas bajos estimados, en tanto un anio adicional no determina un cambio significativo comparado con el resto, quizas se deba a factores como ocupación, sector laboral, y posición jerárquica.

Cada año adicional de educación está asociado con un aumento promedio del salario del 6% (aprox)

### **Sesgo de seleccion | Metodo Heckman**

Al trabajar con salarios de la población femenina, es importante considerar si existe un sesgo muestral debido a la decisión de participar en el mercado laboral. Muchas mujeres enfrentan un "salario de reserva", determinado por el valor que atribuyen a actividades fuera del mercado, como el cuidado del hogar o la crianza de los hijos. Si el salario de mercado no supera ese valor, no participan en el mercado laboral, lo que genera un sesgo de selección en los datos observados. Este sesgo puede hacer que el salario promedio de las mujeres en la muestra sea menor al que sería si toda la población estuviera incluida.

Dado este contexto, utilizo el método de Heckman para ajustar por sesgo de selección y evaluar si la influencia de la educación cambia sustancialmente al corregir este sesgo. Además posteriormente, empleo la descomposición de Oaxaca-Blinder para analizar si existe discriminación salarial entre hombres y mujeres, considerando tanto las características observables como las diferencias en cómo el mercado valora estas características.


#### **Modelo de seleccion**



$$ \text{Desicion} = \text{edad} + \text{edad}^2 + \text{anios_edu} + \text{ingreso jefe familia} + \text{# integrantes} + \text{estrato (dummie)}  $$

```{r}
aux <- f_restricciones(bases24[[1]], gender = "fem", asalariado = FALSE)
aux <- mergear(aux, hogares24[[1]], bases24[[1]])
base24_1_fem_hm <- Heckman_method(aux)

rm(aux)

# Ajustar el modelo principal con lambda
heckman_fem_24 <- lm(log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda, 
                     data = base24_1_fem_hm %>% filter(ingreso>0))

summary(heckman_fem_24)
```

Como la nueva variable $\lambda$ resulta significativa podemos concluir que exite sesgo de selección y en este caso, los coeficientes que intervendrán en el cálculo de la discriminación serán los “corregidos” por sesgo, es decir los que resultan de la última ecuación.

Dadas las condiciones teoricas del metodo de Heckman, vamos a emplearlo en rehacer el grafico previo:


```{r}
heckman_stage2_fem <- rq(log(ingreso)~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda, data=base24_1_fem_hm%>%filter(ingreso>0),tau = taus,ci = FALSE)
summ_heckman_stage2_fem <- summary(heckman_stage2_fem,se="ker")

plot(summ_heckman_stage2_fem, parm =2,
     main = "Coeficientes: Años de Educación", xlab = "Tau (Cuantiles)", ylab = "Coeficientes (Años de Educación)") 
```

Observamos que el comportamiento del efecto marginal de la educacion a lo largo de la distribucion no cambio sustancialmente, sin embargo se observa una reduccion tanto en el extremo maximo ahora representa un aumento promedio del salario del 9% (aprox) por cada anio de educacion (cerca $\tau$ = 0.1) y un aumento en el minimo del 6.5% por cada anio (apartir de $\tau$ = 0.8), algo asi como una compresion tanto por arriba como por abajo de los valores de **anios_edu**. **En conclucion hubo un reduccion en la varianza del efecto marginal a lo largo de la distribucion. **

------------------------------------------------------------------------------------------------------------------------------------------------
# Posible analisis para ver que sucede que la variable "sin instruccion"

```{r}
base24_1_fem_hm %>%
  filter(ingreso_hora > 0) %>%
  group_by(NIVEL_ED) %>% 
  summarise(
    mean_wage = mean(ingreso, na.rm = TRUE),
    median_wage = median(ingreso, na.rm = TRUE),
    sd_wage = sd(ingreso, na.rm = TRUE),
    count = n()
  )
```
------------------------------------------------------------------------------------------------------------------------------------------------

### **MAS**

```{r}
base24_1_mas <- f_restricciones(bases24[[1]],gender = "mas", asalariado = TRUE)

reg1 <- lm(log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2+ as.factor(ubicacion) + as.factor(est_civil) + log_horas, data = base24_1_mas)
reg2 <- lm(log(ingreso) ~ as.factor(NIVEL_ED) + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + as.factor(est_civil) + log_horas, data = base24_1_mas)

summ_reg1 <- summary(reg1)
summ_reg2 <- summary(reg2)

# Extraer los coeficientes, errores estándar, valores t y p-valores del resumen del modelo
coef_reg1 <- coef(summ_reg1)
coef_reg2 <- coef(summ_reg2)

# Filtrar las filas de los coeficientes que te interesan
coef_interes_reg1_m <- coef_reg1[c("anios_edu"), ]
coef_interes_reg2_m <- coef_reg2[grep("NIVEL_ED", rownames(coef_reg2)), ] 
```

#### **Efecto no lineal de la educacion en el retorno económico**

Graficamos el coeficiente estimando, con el p-valor correspondiente de "Nivel Educativo", del 2do modelo.

```{r}
graph_nivel_ed_comparacion(coef_interes_reg2_m[,1], coef_interes_reg2_m[,4], coef_interes_reg2_f[,1], coef_interes_reg2_f[,4])
```

```{r}
# Definir los valores a mostrar
diferencia_coef <- coef_interes_reg2_f[,1] - coef_interes_reg2_m[,1] 
# Crear una tabla con una sola fila
tabla <- data.frame(matrix(diferencia_coef, nrow = 1, dimnames = list("Diferencia", x)))
kable(tabla, format = "markdown")
print(tabla)
```

Se observa un comportamiento similiar al anterior analisis, sin embargo los valores de los coeficientes son significativamente menores, cerca de un 0.1 menores en comparacion del sexo opuesto. Es decir la influencia del maximo nivel educativo alcanzado es menor en los hombres que en las mujeres. 

El comportamiento creciente del primario completo al secundario completo es creciente, caso contrario en el grafico correspondiente al femenino. 

--------------------------------------------------------------------------------------------------------------------------
La variación de los coeficientes de la variable dummie **NIVEL_ED**, sugiere que el efecto en **log(ingreso)** de cada nivel educativo no es constante. Es decir, parece haber un efecto no lineal de la educación.

El retorno económico de completar un nivel educativo cambia significativamente dependiendo de qué nivel se está comparando. Por ejemplo, pasar de primario completo a secundario completo tiene un retorno significatiamente mayor, sugiriendo que las personas que completan el secundario pueden obtener un salario significativamente más alto que aquellos que sólo completan el primario. Pasar del secundario completo a estudios universitarios completos tambien aumenta el ingreso. Por otro lado tener estudios universitarios incompletos tiene el efecto contrario al esperado. 

Los coeficientes para secundario incompleto, completo y universitario incompleto y completo, son todos significativos pues su p-valor es menor a 0.01, ademas son positivos, lo que respalda la idea de que esos niveles educativos tienen un impacto positivo y relevante en los salarios.
Por otro lado, si bien el coeficiente de la categoría **Sin instruccion** es alto en comparación, no es significativo, por tanto no es "influyente" para estimar **log(ingreso)**.

La variación en los coeficientes y su significancia sugiere que el impacto de la educación en los salarios no es lineal. Esto es consistente con la idea de que ciertos niveles de educación (como completar la secundaria o la educación superior) ofrecen ventajas salariales más significativas que simplemente tener un año más de educación.
------------------------------------------------------------------------------------
### ANOVA

Realizamos nuevamente la prueba ANOVA como una prueba mas rigurosa de la no linearildad de la educacion.

```{r}
anova(reg1,reg2)
```

Bajo las hipotesis de la prueba *ANOVA* de ambos modelos, vemos un p-valor menor a 0.01, en tanto controlando por las variables control (valga la redundancia) el nivel educativo máximo alcanzado como variable dummie de cada individuo resulta significativo, contra la variable continua.

### Heterogeneidad en el retorno de la educación | Regresion cuantilica

```{r}
regq1 <- rq(log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas, data=base24_1_mas, tau = taus, ci = FALSE)

summregq1 <- summary(regq1,se="ker")

plot(summregq1,parm =2,
     main = "Coeficientes: Años de Educación", xlab = "Tau (Cuantiles)", ylab = "Coeficientes (Años de Educación)") 
```

Para cuantiles bajos (τ debajo a 0.1), el coeficiente **anios_edu** es cercano a .07. En otras palabras, para este grupo, cada año adicional de educación tiene un impacto del 7% en el aumento de los ingresos. Esto tiene sentido dado que estos individuos, al tener ingresos relativamente bajos, podrían beneficiarse más de la educación en términos de movilidad económica.

A medida que τ se aproxima a 0.5 (mediana de la distribución), el coeficiente disminuye, lo que sugiere que, en la mediana de los ingresos, el impacto de la educación es menos pronunciado. Es decir, el efecto marginal de la educación se atenúa en este grupo, lo cual podría indicar que otros factores además de la educación juegan un rol más importante en la determinación de los ingresos. Cada anio adicional de educacion tiene un impacto del 5.5%.

Finalmente, para los cuantiles altos (τ por encima a 0.8), el coeficiente vuelve a aumentar, lo que sugiere que, para aquellos con ingresos más altos, la educación sigue siendo un factor determinante. Esto podría reflejar que en los niveles más altos de la distribución de ingresos, los años de educación siguen siendo cruciales para alcanzar los ingresos más elevados, probablemente debido a la acumulación de capital humano especializado o credenciales educativas superiores. Para este grupo cada anio adicional de educacion supone un incremento del 8.5%.

### **Sesgo de seleccion | Metodo Heckman | Hombres**

En este análisis, se aplica la corrección por sesgo de selección mediante el método de Heckman solo en la estimación de ingresos para las mujeres. Esto se debe a que las mujeres suelen enfrentar mayores barreras para ingresar al mercado laboral, lo que genera una autoexclusión no aleatoria y puede sesgar las estimaciones del efecto de la educación sobre los ingresos.

En el caso de los hombres, aunque el coeficiente $\lambda$ es estadísticamente significativo, las tasas de participacion laboral son mas altas, la selección en el mercado laboral masculino es menos restrictiva y la autoexclusión del mismo no sigue el mismo patrón sistemático que en las mujeres, concidero que su interpretabilidad es menos clara y por lo tanto no usare el metodo.

De todas formas dejo el codigo del mismo:

```{r}
base24_1_mas_hm <- f_restricciones(bases24[[1]], gender = "mas", asalariado = FALSE)
base24_1_mas_hm <- mergear(base24_1_mas_hm, hogares24[[1]], bases24[[1]])
base24_1_mas_hm <- Heckman_method(base24_1_mas_hm) 
```

```{r}
# Ajustar el modelo principal con lambda
heckman_stage2 <- lm(log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda, 
                     data = base24_1_mas_hm %>% filter(ingreso>0))

# Resumen del modelo
summary(heckman_stage2)
```

```{r}
heckman_stage2_mas <- rq(log(ingreso)~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda, data=base24_1_mas_hm%>%filter(ingreso>0),tau = taus,ci = FALSE)
summ_heckman_stage2_mas <- summary(heckman_stage2_mas,se="ker")

plot(summ_heckman_stage2_mas, parm =2,
     main = "Coeficientes: Años de Educación", xlab = "Tau (Cuantiles)", ylab = "Coeficientes (Años de Educación)") 
```


--------------------------------------------------------
length((base24 %>% filter(CH04 ==1, P21 >0, CH06 <= 65,15 <=CH06, is.na(PP3E_TOT)))$CODUSU)
# Contar las filas con PP3E_TOT = NaN después de aplicar los filtros
result <- base24 %>%
  filter(CH04 == 1, P21 > 0, CH06 <= 65, CH06 >= 15) %>%
  filter(PP3E_TOT==0) %>%
  nrow()

#summary(result$PP3E_TOT)
print(result)
--------------------------------------------------------

### **Desigualdad en el tiempo | Influencia de la educacion**

```{r}
bases23_mas <- list()
bases23_fem <- list()
for (i in 1:4) {
  bases23_mas[[i]] <- f_restricciones(bases23[[i]], gender = "mas", asalariado = TRUE)
  bases23_fem[[i]] <- f_restricciones(bases23[[i]], gender = "fem", asalariado = TRUE)
}

bases24_mas <- list()
bases24_fem <- list()

for(i in 1:2){
  bases24_mas[[i]] <- f_restricciones(bases24[[i]], gender = "mas", asalariado = TRUE)
  bases24_fem[[i]] <- f_restricciones(bases24[[i]], gender = "fem", asalariado = TRUE)
}
```


### Indice Gini 

El indice fue calculado con el sector asalariado, como se ve para ambos sexos y tambien por separado.
Se tomaron los 4 periodos del anio 2023 y los dos primero del 2024.

```{R}
# Inicializar las listas vacías para los tres grupos
ambos <- c()
mas <- c()
fem <- c()

# Calcular el índice de Gini para cada grupo en cada periodo
for(i in 1:4){
  ambos <- c(ambos, Gini(bases23_rest[[i]]$ingreso[bases23_rest[[i]]$ingreso>0]))
  mas   <- c(mas, Gini(bases23_mas[[i]]$ingreso)) 
  fem   <- c(fem, Gini(bases23_fem[[i]]$ingreso))
}
for(i in 1:2){
  ambos <- c(ambos, Gini(bases24_rest[[i]]$ingreso[bases24_rest[[i]]$ingreso>0]))
  mas   <- c(mas, Gini(bases24_mas[[i]]$ingreso)) 
  fem   <- c(fem, Gini(bases24_fem[[i]]$ingreso))
}

graph_gini(ambos, mas, fem)
```
```{r}
ambos
mas
fem
```

La comparación de los valores del índice de Gini entre 2023 y 2024 muestra un aumento de 0.388 a 0.419 para ambos generos, implica un cambio negativo en términos de equidad, ya que indica una mayor desigualdad en la distribución de los ingresos en la población. Se obseva una pendiente mas pronunciada en el genero masculino aun que sigue siendo el genero opuesto mas desigual. Es interesante ver que los valores estan muy cerca del .5, si bien no estan cerca del 1 (desigualdad perfecta) es alarmante ver que no parece descender en el 2024.

```{r}
# Definir los valores a mostrar
diferencia_coef <- fem - mas
anio23 <- mean(diferencia_coef[1:4])
anio24 <- mean(diferencia_coef[5:6])

# Crear una tabla con una sola fila
tabla <- data.frame(matrix(diferencia_coef, nrow = 1, dimnames = list("Diferencia", anios)))
#kable(tabla, format = "markdown")
tabla
anio23 
anio24 
```

La diferencia entre mujeres y hombres fue del 0.047 en 2023 y del .02 en 2024, esto sugiere que la distribución del ingreso femenino es más desigual. Aun que la brecha se fue reduciendo.

### Indice Theil

Una propiedad del índice Theil es que se puede establecer una descomposición aditiva en dos componentes. Para conjuntos de subgrupos mutuamente excluyentes, {1,2,…,$G$}, el índice de Theil puede re-expresarse como:

$$ T = \sum_{g=1}^{G} \frac{n_g \mu_g}{n\mu} T_g  + \sum_{g=1}^{G}\frac{n_g \mu_g}{n\mu} ln(\frac{\mu_g}{\mu}) $$
de acuerdo a Bourguignon (1979), Cowell (1980) y Shorrocks (1980). [1]

donde: 

* $n_g$, es el número de observaciones en el subgrupo $g$. 

* $\mu_g$, es el ingreso medio del subgrupo $g$.

* $T_g$, es el índice Theil calculado para el subgrupo $g$.

El primer sumando representa el componente de la desigualdad atribuido a las diferencias de ingresos **dentro** de un mismo grupo. (**within**)

El segundo sumando representa la desigualdad en los ingresos **entre** los subgrupos de la población. (**between**)

A continuacion calculamos esta descomposicion utilizando como subgrupos los generos y niveles educativos.

```{r}
des <- Descomp_Theil(bases23_rest, bases24_rest,'gender')
x_gen <- des$x 
w_gen <- des$w  
b_gen <- des$b
des <- Descomp_Theil(bases23_fem, bases24_fem,'NIVEL_ED')
x_ed <- des$x 
w_ed <- des$w
b_ed <- des$b
rm(des)
```

#### **Por nivel educativo**

```{r}
graph_theil(x_ed,w_ed,b_ed)
```
```{r}
w_ed / x_ed * 100 
b_ed / x_ed * 100
```

Observamos una situacion similar a la del Gini, en terminos de un aumento en la desiguldad aun que no parece tan pronunciado, la interpretabilidad de la magnitud de la desigualdad en el Theil es diferente por un tema de escalas, la perfecta desigualdad es del $[ln(n)]$ con n el tamanio de la muestra. Sin embargo, la pendiente de la funcion logaritmo natural cae rapidamente. Esto provoca que esa caracteristica no demasiado deseable resulte de poca importancia practica para muestras, como las que utilizamos, lo suficientemente grandes y aproximadamente del mismo tamanio. (entre 14500 y 15000)

Podriamos llevarlo a la escala dividiendo T por [ln(n)] es posible su normalizacion entre 0 y 1. Pero la propiedad de aditividad es la razon por la
cual no se normaliza, ademas ya tenemos idea de que hay una evidente desigualdad gracias al indice Gini, por lo tanto nos centramos en la descomposicion como tal.

La componente **between** es casi constante a lo largo del tiempo, y vemos que la mayor parte del comportamiento de la desigualdad salarial se le atribuye a la componente **within**.

Ademas, la desigualdad de los ingresos **dentro** de cada una de los distintos niveles educativos contribuye aproximadamente con el 89% de la desigualdad y el otro 11% proviene de la desigualdad **entre** los niveles educativos.

Notemos que el índice de Theil aumenta en el cuarto trimestre de 2023, el incremento en la desigualdad salarial se debe principalmente a la desigualdad **dentro** de los subgrupos, que en nuestro análisis corresponden a los niveles educativos.

Conclucion, dentro de cada nivel educativo hay una desigualdad que en promedio contribuye el 89% de la desigualdad total de los asalariados y el restante 11% proviene entre cada uno de los distintos subgrupos educativos. 

#### **Por genero**

```{r}
graph_theil(x_gen,w_gen,b_gen)
```
```{r}
w_gen / x_gen * 100 
b_gen / x_gen * 100
```

Vemos un comportamiento analogo al anterior, sin embargo la componente **within** se lleva un 96% contribuyendo aun mas en $T$, indicando que la mayor parte de la desigualdad proviene de diferencias dentro de cada grupo, más que de la brecha de género en sí misma. No obstante, la desigualdad entre hombres y mujeres (**between**) también aumentó, lo que refleja que las disparidades salariales de género han empeorado.

Estos resultados sugieren que, si bien existen diferencias salariales entre hombres y mujeres, la mayor desigualdad se da dentro de cada grupo, lo que podría estar influenciado por factores como el acceso a mejores empleos, diferencias en la experiencia laboral o segmentación en sectores con distintas estructuras salariales.

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
La componente **between** es casi constante a lo largo del tiempo, y vemos que la mayor parte del comportamiento de la desigualdad salarial se le atribuye a la componente **within**.

Ademas, la desigualdad de los ingresos **dentro** de cada una de las distintas ubicaciones contribuye aproximadamente con el 88% de la desigualdad y el otro 12% proviene de la desigualdad **entre** cada una de las ubicaciones.

Notemos que el índice de Theil aumenta en el cuarto trimestre de 2023, inferimos que hubo un incremento en la desigualdad salarial, el cual se debe principalmente a la desigualdad **dentro** de los subgrupos, que en nuestro análisis corresponden a las ubicaciones.

----------------------------------------------------------------------------------------------------------------------------------------------------------------------

### **Cuantificacion de la influencia de la educacion**

Para ello vamos a realizar la regresion RIF (recenter influence function). Hacemos el cálculo de RIF de `log(ingreso)`, usando como estadístico el índice de Gini, para luego estimar de los coeficientes resultantes de la regresión, tomando **anios_edu**.

```{r}
d1 <- bases23_mas
d2 <- bases23_fem
d3 <- bases23_rest

coefs_rif_edu_mas <- c()
coefs_rif_edu_fem <- c()
coefs_rif_edu <- c()
#coefs_rif_exp <- c()

for(i in 1:4){
  # calculamos RIF en funcion de lwage.
  rif_gini_mas <- rif(log(d1[[i]]$ingreso[d1[[i]]$ingreso >0]), method = "gini")
  rif_gini_fem <- rif(log(d2[[i]]$ingreso[d2[[i]]$ingreso >0]), method = "gini")
  rif_gini <- rif(log(d3[[i]]$ingreso[d3[[i]]$ingreso >0]), method = "gini")
  
  RIFreg_gini_mas <- lm(rif_gini_mas ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = d1[[i]] %>% filter(ingreso >0))
  RIFreg_gini_fem <- lm(rif_gini_fem ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = d2[[i]] %>% filter(ingreso >0))
  RIFreg_gini <- lm(rif_gini ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = d3[[i]] %>% filter(ingreso >0))
  
  edu1 <- RIFreg_gini_mas$coefficients[2]
  edu2 <- RIFreg_gini_fem$coefficients[2]
  edu3 <- RIFreg_gini$coefficients[2]
  #exp <- RIFreg_gini$coefficients[3]
  
  coefs_rif_edu_mas <- c(coefs_rif_edu_mas, edu1)
  coefs_rif_edu_fem <- c(coefs_rif_edu_fem, edu2)
  coefs_rif_edu <- c(coefs_rif_edu, edu3)
  #coefs_rif_exp <- c(coefs_rif_exp, exp)
}

d1 <- bases24_mas
d2 <- bases24_fem
d3 <- bases24_rest

for(i in 1:2){
  # calculamos RIF en funcion de lwage.
  rif_gini_mas <- rif(log(d1[[i]]$ingreso[d1[[i]]$ingreso >0]), method = "gini")
  rif_gini_fem <- rif(log(d2[[i]]$ingreso[d2[[i]]$ingreso >0]), method = "gini")
  rif_gini <- rif(log(d3[[i]]$ingreso[d3[[i]]$ingreso >0]), method = "gini")
  
  RIFreg_gini_mas <- lm(rif_gini_mas ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = d1[[i]] %>% filter(ingreso >0))
  RIFreg_gini_fem <- lm(rif_gini_fem ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = d2[[i]] %>% filter(ingreso >0))
  RIFreg_gini <- lm(rif_gini ~ anios_edu + exp_pot + exp_pot_2 + edad + edad_2 + as.factor(ubicacion) + log_horas, data = d3[[i]] %>% filter(ingreso >0))
  
  edu1 <- RIFreg_gini_mas$coefficients[2]
  edu2 <- RIFreg_gini_fem$coefficients[2]
  edu3 <- RIFreg_gini$coefficients[2]
  #exp <- RIFreg_gini$coefficients[3]
  
  coefs_rif_edu_mas <- c(coefs_rif_edu_mas, edu1)
  coefs_rif_edu_fem <- c(coefs_rif_edu_fem, edu2)
  coefs_rif_edu <- c(coefs_rif_edu, edu3)
  #coefs_rif_exp <- c(coefs_rif_exp, exp)
}
```


### Gráfico de las estimaciones de años de educación 

```{r}
graph_RIF(coefs_rif_edu_mas,coefs_rif_edu_fem)
```

Observando los valores de las estimaciones, vemos que los coeficientes de años de educación son negativos pero con ordenes de magnitud poco significativos, lo que sugiere que un aumento en la educación está asociado con una reducción de la desigualdad salarial. Sin embargo, la magnitud de estos coeficientes es pequeña, lo que indica que el efecto es moderado en términos absolutos.

Esto implica que, si bien la educación juega un rol en la reducción de la desigualdad, su impacto no es drástico y probablemente necesite ser complementado con otros factores, como políticas de acceso al mercado laboral y demas factores. Además, dado que el índice de Gini mide desigualdad de manera agregada, cambios en la educación pueden tardar en reflejarse de manera significativa en la distribución salarial.

En conclusión, la educacion cuantitavamente parece afectar de manera igual a ambos sexos,los resultados sugieren que más educación contribuye a reducir la desigualdad, pero su impacto, al menos en este modelo, es limitado en magnitud.

### **Influencia de las variables en la Diferencia salarial | Descomposicion Oaxaca-Blinder**

Para cuantificar la influencia de la educacion, experiencia laboral (potencial) y horas trabajadas en la diferencia salarial, vamos a usar la descomposicion de Oaxaca-Blinder usando como coeficientes de referencia el modelo propuesto por Jann (2008) que brinda la posibilidad de ampliar un analisis si fuese asi a mas de dos grupos, ademas porque suponemos que ambos generos comparten la misma estructura salarial.

Para ello aplicamos el metodo de heckman a ambos generos, pues encontramos que la variable $\lambda$ es signficativa en ambos modelos, para tener resultados totalmente comparables asi tener una consistencia metodologica simetrica. No menciono la contribucion a la brecha salarial de la variable debido a que su interpretabilidad no resulta directa, ya que no es una caracteristica del individuo "promedio", sino del proceso de seleccion en el mercado laboral.

```{r}
# Primero definimos la lista donde iteraremos cada data.frame 
bases23_fem_hm <- list()
bases23_mas_hm <- list()
for(i in 1:4){
  aux <- f_restricciones(bases23[[i]], gender = "fem", asalariado = FALSE)
  aux <- mergear(aux, hogares23[[i]], bases23[[i]])
  bases23_fem_hm[[i]] <- Heckman_method(aux) 
  
  aux <- f_restricciones(bases23[[i]], gender = "mas", asalariado = FALSE)
  aux <- mergear(aux, hogares23[[i]], bases23[[i]])
  bases23_mas_hm[[i]] <- Heckman_method(aux) 
}
bases24_fem_hm <- list()
bases24_mas_hm <- list()
for(i in 1:2){
  aux <- f_restricciones(bases24[[i]], gender = "fem", asalariado = FALSE)
  aux <- mergear(aux, hogares24[[i]], bases24[[i]])
  bases24_fem_hm[[i]] <- Heckman_method(aux) 
  
  aux <- f_restricciones(bases24[[i]], gender = "mas", asalariado = FALSE)
  aux <- mergear(aux, hogares24[[i]], bases24[[i]])
  bases24_mas_hm[[i]] <- Heckman_method(aux) 
}
```

```{r}
fem_23 <- bases23_fem_hm[[1]] %>% filter(ingreso >0) 
mas_23 <- bases23_mas_hm[[1]] %>% filter(ingreso >0) 

fem_24 <- bases24_fem_hm[[2]] %>% filter(ingreso >0) 
mas_24 <- bases24_mas_hm[[2]] %>% filter(ingreso >0) 

fem_23$fem = 1; fem_24$fem = 1 
mas_23$fem = 0; mas_24$fem = 0 
data_combined23 <- rbind(fem_23, mas_23) ; data_combined24 <- rbind(fem_24, mas_24) 
data_combined23$fem <- as.numeric(as.character(data_combined23$fem));  data_combined24$fem <- as.numeric(as.character(data_combined24$fem))
```

```{r}
oaxaca_result23 <- oaxaca(
  formula = log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda | fem,
  data = data_combined23,
)

oaxaca_result24 <- oaxaca(
  formula = log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda | fem,
  data = data_combined24,
)
```

Vamos a usar la siguiente transformacion para cuantificar en terminos de procentaje la diferencia salarial, dada $x = Media(log(ingresoA)) - Media(log(ingresoB))$

$$ e^{x} - 1 $$
Como tenemos una cantidad de datos similar correspondientes a los diferentes grupos (generos), aprobechando propiedades del log junto con la media geometrica, encuentro esta transformacion adecuada para obtener una cuantificacion interpretativa.

### Anio 2023

```{r}
# "(Intercept)","lambda","exp_pot_2"
aver <- c("(Intercept)","anios_edu","exp_pot","log_horas")
twoFold23 <- oaxaca_result23$twofold$overall[6,]

plot(oaxaca_result23, decomposition = "twofold", group.weight = -2, variables = aver)

plot(oaxaca_result23, decomposition = 'twofold', group.weight = -2, unexplained.split = TRUE, components = c("unexplained A","unexplained B"), 
     component.labels = c("unexplained A" = "a favor de hombres", 'unexplained B' = "en contra de las mujeres"),
     variables = aver)

print(twoFold23)
```
```{r}
twoFold24 <- oaxaca_result24$twofold$overall[6,]

plot(oaxaca_result24, decomposition = "twofold", group.weight = -2,variables = aver)

plot(oaxaca_result24, decomposition = 'twofold', group.weight = -2, unexplained.split = TRUE, components = c("unexplained A","unexplained B"), 
     component.labels = c("unexplained A" = "a favor de hombres", 'unexplained B' = "en contra de las mujeres"),
      variables = aver)
twoFold24
```

```{r}
porce(twoFold23[['coef(explained)']] + twoFold23[['coef(unexplained)']])
porce(twoFold24[['coef(explained)']] + twoFold24[['coef(unexplained)']])

porce(-3.291183e-02)
porce(7.116259e-02)

oaxaca_result23$twofold$variables[[6]]

twoFold24[["coef(unexplained)"]] / (twoFold24[['coef(explained)']] + twoFold24[['coef(unexplained)']])
```

Hay una diferencia salarial del 48% a favor de los hombres, es decir que en promedio, el ingreso de los hombres es un 48% mas que de las mujeres en 2023, y este procentaje crece un 1,3% para 2024. 

El intercept en ambos anios, esta cerca del 1.8 con una varianza alrededor de 0.1 con lo cual podemos afirmar que hay una diferencia estructural salarial base entre ambos grupos conciderable, afecta en mayor medida que las variables que estoy estudiando, sin embargo anios educativos, experiencia potencial y logaritmo de horas mensuales trabajadas tienen influencia en la parte no explicada de la descomposicion que como veremos es la que mas influye en la brecha.

2023: explained = -3.291183e-02
2024: explained = 7.116259e-02

En ambos anios vemos que la parte explicativa contribuye de forma limitada comparada con su contraparte. En 2023 las diferencias en caracteristicas observadas, tiene un signo negativo, indica una valoracion mayor al genero femenino, y muestra que las mujeres ganan aproximadamente un 3,2 % mas que los hombres. Para el 2024 esto cambia, siendo un 7% mayor el ingreso del genero masculino frente al femenino. 

anios educativos -.08, al tener un signo negativo indica que las mujeres tienen en promedio mas anios educativos que el genero masculino, como vimos una asociasion positiva del salario con los anios educativos, esto deberia reducir la brecha.

exp_pot .04 y .02, refleja que en promedio los hombres tienen mas anios de experiencia potencial que las mujeres, esto puede deberse a que historicamente las mujeres han tenido mas interupciones en sus carreras profesionales. Se observa un comportamiento similar para exp_pot_2, con el signo cambiado, esto sugiere que a medida que aumenta la experiencia el crecimiento salarial se desacelera. Explicando parte de la brecha.

log_horas .02 y .08, nuevamente en promedio el genero masculino suele tener mas horas laborales en su principal ocupacion, contribuyendo a la parte explicativa de la brecha.

En 2024 la parte no explicada contribuye con el 82.3% en la brecha salarial, midiendo la diferencia salarial que no puede atribuirse a diferencias en características observables de los individuos, sino a como el mercado valora u remunera a cada genero, para ello me resulta interesante cuantificar cuanto y cuales son esas caracteristicas. Posibles casusas:

+ Diferencias en cómo el mercado laboral remunera a cada grupo.
+ Factores estructurales que afectan a los grupos de manera diferente.
+ Discriminación salarial, barreras de acceso o segregación ocupacional.
+ Omisión de variables relevantes que afectan los salarios.

En intercept se incrementa del 2023 al 2024 a favor del genero masculino, esto es que la desigualdad estructural no capturada por el modelo favorecio aun mas a los hombres.

anios educativos del 2023 al 2024, se ve una reduccion de la desventaja, en contra del genero masculino, aun que sigue siendo influyente. Caso contrario en el genero femenino ya que se ve una reduccion de la ventaja a favor.

exp_pot mantiene un comportamiento similar en ambos anios, se observa que los hombres obtienen menos retornos de la experiencia, sin embargo las mujeres obtienen mayores retornos de lo esperado en 2024, ya que en 2023 el intervalo de confianza del 95% incluye a valores negativos y positivos, no se puede hacer tal afirmacion. 

log_horas en 2023 toman valores negativos cercanos al 0, en las componentes a favor del genero masculino y en contra del genero femenino, donde uno sus intervalos de confianza incluye al 0.
En 2024 se observa un incremento en contro del genero masculino al obtener menos retornos del log_horas, caso contrario que las mujeres donde obtienen un incremento en sus retornos por log_horas.

### Cambios en el tipo de organizacion que pertenecen 

```{r}
fem_23 <- bases23_fem_hm[[1]] %>% filter(ingreso >0,PP04C >= 10, PP04C != 99)
mas_23 <- bases23_mas_hm[[1]] %>% filter(ingreso >0,PP04C >= 10, PP04C != 99)

fem_24 <- bases24_fem_hm[[2]] %>% filter(ingreso >0,PP04C >= 10, PP04C != 99)
mas_24 <- bases24_mas_hm[[2]] %>% filter(ingreso >0,PP04C >= 10, PP04C != 99)

fem_23$fem = 1; fem_24$fem = 1
mas_23$fem = 0; mas_24$fem = 0
data_combined23 <- rbind(fem_23, mas_23) ; data_combined24 <- rbind(fem_24, mas_24)
data_combined23$fem <- as.numeric(as.character(data_combined23$fem));  data_combined24$fem <- as.numeric(as.character(data_combined24$fem))
```

```{r}
oaxaca_result23 <- oaxaca(
  formula = log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda | fem,
  data = data_combined23,
)

oaxaca_result24 <- oaxaca(
  formula = log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda | fem,
  data = data_combined24,
)

length(mas_23$PP04C)
length(fem_23$PP04C)
mas_23[2,]

unique(fem_23$ubicacion)
unique(mas_23$ubicacion)
modelo_prueba <- lm(log(ingreso) ~ anios_edu + exp_pot + exp_pot_2 + as.factor(ubicacion) + log_horas + lambda, 
                     data = data_combined23)

summary(modelo_prueba)


library(car)
vif(modelo_prueba)

# Verificar variables en los datos
str(data_combined23)
str(data_combined24)

# Verificar valores faltantes
sum(is.na(data_combined23))
sum(is.na(data_combined24))

# Verificar niveles de factores
levels(data_combined23$ubicacion)
levels(data_combined24$ubicacion)
```
